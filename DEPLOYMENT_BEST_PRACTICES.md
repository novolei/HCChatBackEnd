# ğŸš€ éƒ¨ç½²æœ€ä½³å®è·µ

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

### âœ… åº”è¯¥åšçš„

1. **æ‰€æœ‰ä»£ç ä¿®æ”¹åœ¨æœ¬åœ°å®Œæˆ**
   - åœ¨ Mac ä¸Šç¼–è¾‘ä»£ç 
   - æœ¬åœ°æµ‹è¯•é€šè¿‡åæäº¤
   - æ¨é€åˆ° GitHub
   - åœ¨ VPS ä¸Šæ‹‰å–éƒ¨ç½²

2. **ä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬**
   - ä½¿ç”¨ `deploy.sh` éƒ¨ç½²
   - è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†å†²çª

3. **ä¿æŒ VPS ä»£ç åªè¯»**
   - VPS åªç”¨äºè¿è¡ŒæœåŠ¡
   - ä¸åœ¨ VPS ä¸Šç¼–è¾‘æ–‡ä»¶

---

### âŒ ä¸åº”è¯¥åšçš„

1. **ä¸è¦åœ¨ VPS ä¸Šç›´æ¥ä¿®æ”¹ä»£ç **
   - âŒ `vim server.js`
   - âŒ `nano server.js`
   - âŒ ç›´æ¥ `git commit`

2. **ä¸è¦æ‰‹åŠ¨ git pull**
   - ä½¿ç”¨éƒ¨ç½²è„šæœ¬ä»£æ›¿

---

## ğŸ”„ æ¨èçš„å¼€å‘æµç¨‹

### æ–¹æ¡ˆ 1: ä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰âœ…

```bash
# åœ¨ Mac æœ¬åœ°
cd /Users/ryanliu/DDCS/HChat/HCChatBackEnd

# 1. ç¼–è¾‘ä»£ç 
vim chat-gateway/server.js

# 2. æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
# docker compose up chat-gateway

# 3. æäº¤
git add .
git commit -m "ä¿®å¤: xxx"
git push origin main

# 4. ä¸€é”®éƒ¨ç½²åˆ° VPS
./deploy.sh chat-gateway
```

**deploy.sh ä¼šè‡ªåŠ¨ï¼š**
- âœ… SSH åˆ° VPS
- âœ… æ‹‰å–æœ€æ–°ä»£ç ï¼ˆè‡ªåŠ¨å¤„ç†å†²çªï¼‰
- âœ… é‡å¯æœåŠ¡
- âœ… æ˜¾ç¤ºæ—¥å¿—

---

### æ–¹æ¡ˆ 2: æ‰‹åŠ¨éƒ¨ç½²ï¼ˆå¤‡ç”¨ï¼‰

å¦‚æœéƒ¨ç½²è„šæœ¬æœ‰é—®é¢˜ï¼Œæ‰‹åŠ¨æ“ä½œï¼š

```bash
# åœ¨æœ¬åœ°æ¨é€å
ssh root@mx.go-lv.com

# åœ¨ VPS ä¸Š
cd /root/hc-stack
git fetch origin
git reset --hard origin/main  # å¼ºåˆ¶åŒæ­¥åˆ°è¿œç¨‹ç‰ˆæœ¬
docker compose restart chat-gateway
docker compose logs -f chat-gateway
```

---

## ğŸ›¡ï¸ é…ç½® Git è‡ªåŠ¨åˆå¹¶ç­–ç•¥

åœ¨ VPS ä¸Šæ‰§è¡Œä¸€æ¬¡ï¼Œä»¥å pull ä¼šè‡ªåŠ¨å¤„ç†ï¼š

```bash
# åœ¨ VPS ä¸Šæ‰§è¡Œ
cd /root/hc-stack

# é…ç½®ä¸ºä½¿ç”¨ rebaseï¼ˆæ¨èï¼‰
git config pull.rebase true

# æˆ–è€…é…ç½®ä¸º fast-forward onlyï¼ˆæ›´å®‰å…¨ï¼‰
git config pull.ff only
```

è¿™æ ·é…ç½®åï¼Œå¦‚æœæœ‰å†²çªä¼šè‡ªåŠ¨æŠ¥é”™è€Œä¸æ˜¯å¡ä½ã€‚

---

## ğŸ“¦ æ”¹è¿›åçš„éƒ¨ç½²è„šæœ¬

æˆ‘ä»¬çš„ `deploy.sh` å·²ç»å¤„ç†äº†å¤§éƒ¨åˆ†é—®é¢˜ï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥æ”¹è¿›ï¼š

```bash
# åœ¨ VPS ä¸Šå¼ºåˆ¶åŒæ­¥ï¼ˆä¸ä¼šæœ‰å†²çªï¼‰
git fetch origin
git reset --hard origin/main
```

---

## ğŸ” æ£€æµ‹å’Œé¢„é˜²

### å®šæœŸæ£€æŸ¥ VPS çŠ¶æ€

```bash
# åœ¨ VPS ä¸Š
cd /root/hc-stack
git status

# åº”è¯¥æ˜¾ç¤ºï¼š
# On branch main
# Your branch is up to date with 'origin/main'.
# nothing to commit, working tree clean
```

å¦‚æœæ˜¾ç¤ºæœ‰ä¿®æ”¹æˆ–æœªæäº¤çš„æ–‡ä»¶ï¼Œè¯´æ˜æœ‰äººåœ¨ VPS ä¸Šæ”¹äº†ä»£ç ï¼

---

### ä½¿ç”¨åªè¯»éƒ¨ç½²ï¼ˆé«˜çº§ï¼‰

å¦‚æœå›¢é˜Ÿåä½œï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **CI/CD è‡ªåŠ¨éƒ¨ç½²**
   - GitHub Actions
   - GitLab CI
   - Jenkins

2. **å®¹å™¨åŒ–éƒ¨ç½²**
   - æ„å»º Docker é•œåƒ
   - æ¨é€åˆ°é•œåƒä»“åº“
   - VPS åªæ‹‰å–é•œåƒ

3. **æ–‡ä»¶æƒé™æ§åˆ¶**
   ```bash
   # è®©ä»£ç ç›®å½•åªè¯»ï¼ˆæç«¯æƒ…å†µï¼‰
   chmod -R 555 /root/hc-stack/chat-gateway
   ```

---

## ğŸš¨ ç´§æ€¥æƒ…å†µå¤„ç†

### å¦‚æœä¸å°å¿ƒåœ¨ VPS ä¸Šæ”¹äº†ä»£ç 

**æ–¹æ¡ˆ 1: ä¿å­˜ä¿®æ”¹åˆ°æœ¬åœ°**
```bash
# åœ¨ VPS ä¸Š
cd /root/hc-stack
git diff > ~/my-changes.patch

# ç„¶åé‡ç½®
git reset --hard origin/main

# åœ¨æœ¬åœ°åº”ç”¨è¡¥ä¸
scp root@mx.go-lv.com:~/my-changes.patch .
git apply my-changes.patch
```

**æ–¹æ¡ˆ 2: ç›´æ¥ä¸¢å¼ƒï¼ˆä¸é‡è¦çš„ä¿®æ”¹ï¼‰**
```bash
cd /root/hc-stack
git reset --hard origin/main
```

---

## ğŸ“Š å›¢é˜Ÿåä½œå»ºè®®

### å¼€å‘åˆ†æ”¯ç­–ç•¥

```
main (ç”Ÿäº§) â† åªä» dev åˆå¹¶
  â†‘
dev (å¼€å‘) â† æ—¥å¸¸å¼€å‘
  â†‘
feature/xxx â† åŠŸèƒ½åˆ†æ”¯
```

### éƒ¨ç½²æµç¨‹

1. **å¼€å‘ç¯å¢ƒ**
   ```bash
   git checkout dev
   # å¼€å‘...
   git push origin dev
   ./deploy.sh chat-gateway --branch dev --env staging
   ```

2. **ç”Ÿäº§ç¯å¢ƒ**
   ```bash
   git checkout main
   git merge dev
   git push origin main
   ./deploy.sh chat-gateway
   ```

---

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] æœ¬åœ°ä»£ç å·²æäº¤
- [ ] å·²æ¨é€åˆ° GitHub
- [ ] ä½¿ç”¨ deploy.sh éƒ¨ç½²
- [ ] éƒ¨ç½²åæ£€æŸ¥æ—¥å¿—
- [ ] æµ‹è¯•åŠŸèƒ½æ­£å¸¸

---

## ğŸ¯ æ€»ç»“

### é»„é‡‘æ³•åˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ°¸è¿œä¸è¦åœ¨ VPS ä¸Šç›´æ¥ä¿®æ”¹ä»£ç ï¼       â”‚
â”‚                                         â”‚
â”‚  å¼€å‘ â†’ æäº¤ â†’ æ¨é€ â†’ éƒ¨ç½²             â”‚
â”‚  (æœ¬åœ°) (Git) (GitHub) (VPS)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸€å¥è¯è®°ä½

**"VPS æ˜¯è¿è¡Œç¯å¢ƒï¼Œä¸æ˜¯å¼€å‘ç¯å¢ƒ"** ğŸ¯

---

éµå¾ªè¿™äº›å®è·µï¼Œå°±ä¸ä¼šå†é‡åˆ° Git å†²çªé—®é¢˜äº†ï¼âœ¨

